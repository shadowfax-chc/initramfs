#!/bin/busybox sh

echo "Mounting dev proc sys"
mount -t devtmpfs none /dev
mount -t proc none /proc
mount -t sysfs none /sys

echo "Enabling lvm"
lvm vgscan --mknodes
lvm lvchange -aly vgsys/lvroot
lvm lvchange -aly vgsys/lvusr

echo "Mounting root"
mount -o ro /dev/mapper/vgsys-lvroot /mnt/root

echo "Mounting usr for udev"
mount -o rw /dev/mapper/vgsys-lvusr /mnt/root/usr

echo "Cleaning up"
umount /proc
umount /sys
umount /dev

echo "Switching root"
exec switch_root /mnt/root /sbin/init
